# Task 050: Generate Mocks and Create README

## Context

This task is part of work unit 004: creating a new `libs/git` Go module. The previous tasks created all the core functionality (types, Git operations, GitHubClient, worktrees). This task generates mocks for testing and creates the README documentation.

**Two deliverables**:
1. Generated mock for `GitHubClient` interface using `moq`
2. README.md following the READMES.md standard

## Requirements

### 1. Generate GitHubClient Mock

The go:generate directive should already be in client.go (from task 030):
```go
//go:generate go run github.com/matryer/moq@latest -out mocks/client.go -pkg mocks . GitHubClient
```

Run the generator to create `mocks/client.go`:
```bash
cd libs/git && go generate ./...
```

Verify the mock:
- `GitHubClientMock` struct is generated
- All interface methods have corresponding `*Func` fields
- Compile-time check passes: `var _ GitHubClient = (*mocks.GitHubClientMock)(nil)`

### 2. Create README.md

Create `libs/git/README.md` following the READMES.md standard structure:

**Sections required**:
1. **Title and Overview** (1-3 sentences)
2. **Quick Start** (copy-paste example)
3. **Usage** (2-4 common tasks)
4. **Configuration** (options if any)
5. **Troubleshooting** (common issues)
6. **Links** (to related docs)

**Content to include**:
- What the package provides: Git operations and GitHub integration
- How to create a Git instance
- How to create a GitHubClient
- How to use mocks in tests
- Common error handling patterns

### 3. Create mocks Directory Structure

```
libs/git/
└── mocks/
    └── client.go   # Generated GitHubClientMock
```

### 4. Verify Module Completeness

After this task, the module should pass all these checks:
```bash
cd libs/git
go build ./...           # Compiles
go test ./...            # All tests pass
go generate ./...        # Generates mocks
golangci-lint run        # No linting issues
```

## Acceptance Criteria

1. **Mock generated**: `mocks/client.go` exists and compiles
2. **Mock implements interface**: `GitHubClientMock` implements `GitHubClient`
3. **Mock has all methods**: All interface methods have corresponding funcs
4. **README exists**: `libs/git/README.md` is created
5. **README follows standard**: Contains all required sections
6. **Quick Start works**: Example code compiles
7. **Usage examples are clear**: Cover main use cases
8. **Module builds**: `go build ./...` passes
9. **Tests pass**: `go test ./...` passes
10. **Linting passes**: `golangci-lint run` has no issues

### Test Requirements (TDD)

This task focuses on documentation and mock generation, but should include:

Write a simple test in `mocks/client_test.go` to verify the mock works:
```go
func TestGitHubClientMock_Implements_Interface(t *testing.T) {
    mock := &mocks.GitHubClientMock{
        CheckAvailabilityFunc: func() error { return nil },
    }

    var _ git.GitHubClient = mock
}
```

Also verify mocks work with existing tests from task 030.

## Technical Details

### Mock Generation Command

```bash
# From libs/git directory
go generate ./...

# Or explicitly
go run github.com/matryer/moq@latest -out mocks/client.go -pkg mocks . GitHubClient
```

### Mock File Header

The generated file will have this header:
```go
// Code generated by moq; DO NOT EDIT.
// github.com/matryer/moq

package mocks

import (
    "github.com/jmgilman/sow/libs/git"
    "sync"
)

var _ git.GitHubClient = &GitHubClientMock{}
```

### README Template

Follow this structure based on READMES.md:

```markdown
# sow Git

Git and GitHub operations library for sow.

## Quick Start

[code example]

## Usage

### Git Operations

[examples]

### GitHub Operations

[examples]

### Testing with Mocks

[examples]

## Troubleshooting

[common issues]

## Links

[related docs]
```

## Relevant Inputs

- `libs/exec/README.md` - Reference README to follow
- `libs/exec/mocks/executor.go` - Reference mock structure
- `libs/git/client.go` - GitHubClient interface (from task 030)
- `.standards/STYLE.md` - Coding standards to follow
- `.standards/TESTING.md` - Testing standards to follow
- `.standards/READMES.md` - README format standard (CRITICAL for this task)

## Examples

### README Quick Start Section

```markdown
## Quick Start

```go
import "github.com/jmgilman/sow/libs/git"

// Git operations
g, err := git.NewGit("/path/to/repo")
if err != nil {
    log.Fatal(err)
}

branch, _ := g.CurrentBranch()
fmt.Printf("Current branch: %s\n", branch)

// GitHub operations
client, err := git.NewGitHubClient()
if err != nil {
    log.Fatal(err)
}

issues, _ := client.ListIssues("bug", "open")
for _, issue := range issues {
    fmt.Printf("#%d: %s\n", issue.Number, issue.Title)
}
```
```

### README Usage Section

```markdown
## Usage

### Create a Git Instance

```go
g, err := git.NewGit("/path/to/repo")
if err != nil {
    var notRepo git.ErrNotGitRepository
    if errors.As(err, &notRepo) {
        fmt.Printf("%s is not a git repository\n", notRepo.Path)
    }
    return err
}

// Check current branch
branch, err := g.CurrentBranch()

// Check for protected branches
if g.IsProtectedBranch(branch) {
    fmt.Println("Warning: on protected branch")
}

// Check for uncommitted changes
hasChanges, err := g.HasUncommittedChanges()
```

### GitHub Operations

```go
import "github.com/jmgilman/sow/libs/exec"

// Create client
ghExec := exec.NewLocalExecutor("gh")
client := git.NewGitHubCLI(ghExec)

// Check availability
if err := client.CheckAvailability(); err != nil {
    return fmt.Errorf("GitHub not available: %w", err)
}

// List issues
issues, err := client.ListIssues("sow", "open")

// Create PR
prNum, prURL, err := client.CreatePullRequest("My PR", "Description", true)
```

### Worktree Operations

```go
// Get worktree path
wtPath := git.WorktreePath(repoRoot, "feat/auth")

// Check for uncommitted changes first
if err := git.CheckUncommittedChanges(g); err != nil {
    return err
}

// Create worktree
if err := git.EnsureWorktree(g, repoRoot, wtPath, "feat/auth"); err != nil {
    return err
}
```

### Testing with Mocks

```go
import "github.com/jmgilman/sow/libs/git/mocks"

func TestMyService(t *testing.T) {
    mock := &mocks.GitHubClientMock{
        CheckAvailabilityFunc: func() error { return nil },
        ListIssuesFunc: func(label, state string) ([]git.Issue, error) {
            return []git.Issue{
                {Number: 1, Title: "Test Issue"},
            }, nil
        },
    }

    svc := NewMyService(mock)
    // ... test logic
}
```
```

### README Troubleshooting Section

```markdown
## Troubleshooting

### "GitHub CLI (gh) not found"

Install the GitHub CLI from https://cli.github.com/

### "GitHub CLI not authenticated"

Run `gh auth login` to authenticate.

### "not a git repository"

Ensure the path points to a directory containing `.git/`.

### Worktree creation fails

- Ensure there are no uncommitted changes in the main repo
- Check that the branch name is valid
- Verify you have write permissions to the worktree path
```

## Dependencies

- Tasks 010-040 must complete first - all source code must exist
- `moq` package must be available (will be fetched by go run)

## Constraints

- Do NOT modify the generated mock file manually
- Do NOT commit temporary files from mock generation
- README must be self-contained (don't reference external docs that don't exist)
- Examples in README must compile
- Keep README concise - link to godoc for detailed API reference
