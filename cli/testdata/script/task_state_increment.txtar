# Test task state increment command
# Should increment the iteration counter

exec git init
exec git config user.email 'test@example.com'
exec git config user.name 'Test User'
exec git commit --allow-empty -m 'Initial commit'
exec git checkout -b feat/test-feature
exec sow init
exec sow project init my-feature --description 'Add new feature'

# Transition to implementation phase
exec sow project phase enable discovery --type feature
exec sow project phase complete discovery
exec sow project phase enable design
exec sow project phase complete design

# Add a task
exec sow task add 'Add authentication' --description 'Implement JWT auth'
stderr '✓ Created task 010'

# Verify initial iteration is 1
exec cat .sow/project/phases/implementation/tasks/010/state.yaml
stdout 'iteration: 1'

# Increment iteration
exec sow task state increment 010
stderr '✓ Incremented iteration: 1 → 2'

# Verify iteration was incremented
exec cat .sow/project/phases/implementation/tasks/010/state.yaml
stdout 'iteration: 2'

# Increment again
exec sow task state increment 010
stderr '✓ Incremented iteration: 2 → 3'

# Verify iteration was incremented again
exec cat .sow/project/phases/implementation/tasks/010/state.yaml
stdout 'iteration: 3'

# Test with non-existent task
! exec sow task state increment 099
stderr 'not found'

# Test with invalid task ID
! exec sow task state increment 01
stderr 'invalid task ID'

# Verify state validates
exec sow validate
stderr '✓ All validations passed'
