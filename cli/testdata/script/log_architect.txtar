# Test task-level logging with architect agent
# Should use architect-1 as agent ID

exec git init

-- .sow/.version --
1.0.0

-- .sow/refs/index.json --
{
  "version": "1.0.0",
  "refs": []
}

-- .sow/project/state.yaml --
project:
  name: test-project
  branch: main
  description: Test project
  created_at: 2025-10-16T10:00:00Z
  updated_at: 2025-10-16T10:00:00Z
phases:
  discovery:
    status: skipped
    enabled: false
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    discovery_type: null
    artifacts: []
  design:
    status: in_progress
    enabled: true
    created_at: 2025-10-16T10:00:00Z
    started_at: 2025-10-16T10:00:00Z
    completed_at: null
    architect_used: true
    artifacts: []
  implementation:
    status: pending
    enabled: true
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    planner_used: null
    tasks: []
    pending_task_additions: null
  review:
    status: pending
    enabled: true
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    iteration: 1
    reports: []
  finalize:
    status: pending
    enabled: true
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    project_deleted: false
    pr_url: null

-- .sow/project/phases/implementation/tasks/010/state.yaml --
task:
  id: "010"
  name: "Design architecture"
  phase: implementation
  status: in_progress
  created_at: 2025-10-16T10:00:00Z
  started_at: 2025-10-16T10:00:00Z
  updated_at: 2025-10-16T10:00:00Z
  completed_at: null
  iteration: 1
  assigned_agent: architect
  references: []
  feedback: []
  files_modified: []

# Navigate to task directory
cd .sow/project/phases/implementation/tasks/010

# Create a task log entry
exec sow log --action created_file --result success --file docs/architecture.md --notes "Created architecture diagram"
stderr 'âœ“ Log entry added to task log'

# Verify log file was created
exists log.md

# Verify log content includes architect agent ID
exec cat log.md
stdout 'timestamp:'
stdout 'agent: architect-1'
stdout 'action: created_file'
stdout 'result: success'
stdout '  - docs/architecture.md'
stdout 'Created architecture diagram'
