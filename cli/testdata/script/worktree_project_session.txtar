# Test project session worktree creation and state

# =====================================
# Setup Git Repository
# =====================================
exec git init
exec git config user.email 'test@example.com'
exec git config user.name 'Test User'

# Create .gitignore
exec sh -c 'echo ".sow/worktrees/" > .gitignore'
exec sh -c 'echo ".sow/sinks/" >> .gitignore'
exec sh -c 'echo ".sow/repos/" >> .gitignore'

exec git add .gitignore
exec git commit -m 'Initial commit'

# Initialize sow
exec sow init
exec git add .sow
exec git commit -m 'Initialize sow'

env SOW_SKIP_UNCOMMITTED_CHECK=1

# =====================================
# Test: Create Project Session
# =====================================

exec sow project --branch feat/auth --no-launch

# Verify worktree exists with project state
exists .sow/worktrees/feat/auth/.git
exists .sow/worktrees/feat/auth/.sow/project

# Verify NO exploration state
! exists .sow/worktrees/feat/auth/.sow/exploration

# List worktrees
exec sow worktree list
stdout 'feat/auth'
stdout 'project'

exec git worktree list
stdout 'feat/auth'
