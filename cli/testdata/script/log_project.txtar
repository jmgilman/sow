# Test project-level logging
# Should create log entries in .sow/project/log.md

exec git init

-- .sow/.version --
1.0.0

-- .sow/refs/index.json --
{
  "version": "1.0.0",
  "refs": []
}

-- .sow/project/state.yaml --
project:
  name: test-project
  branch: main
  description: Test
  created_at: 2025-10-16T10:00:00Z
  updated_at: 2025-10-16T10:00:00Z
phases:
  discovery:
    status: skipped
    enabled: false
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    discovery_type: null
    artifacts: []
  design:
    status: skipped
    enabled: false
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    architect_used: null
    artifacts: []
  implementation:
    status: in_progress
    enabled: true
    created_at: 2025-10-16T10:00:00Z
    started_at: 2025-10-16T10:00:00Z
    completed_at: null
    planner_used: null
    tasks: []
    pending_task_additions: null
  review:
    status: pending
    enabled: true
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    iteration: 1
    reports: []
  finalize:
    status: pending
    enabled: true
    created_at: 2025-10-16T10:00:00Z
    started_at: null
    completed_at: null
    project_deleted: false
    pr_url: null

# Create a project log entry
exec sow log --action started_task --result success --notes "Starting implementation"
stderr '✓ Log entry added to project log'

# Verify log file was created
exists .sow/project/log.md

# Verify log content
exec cat .sow/project/log.md
stdout 'timestamp:'
stdout 'agent: orchestrator'
stdout 'action: started_task'
stdout 'result: success'
stdout 'Starting implementation'

# Add another entry with files
exec sow log --action created_file --result success --file src/main.go --file tests/main_test.go --notes "Created main module"
stderr '✓ Log entry added to project log'

# Verify both entries exist
exec cat .sow/project/log.md
stdout 'created_file'
stdout 'src/main.go'
stdout 'tests/main_test.go'
stdout 'Created main module'

# Test forced project-level logging from any location
mkdir subdir
cd subdir
exec sow log --project --action completed_task --result success
stderr '✓ Log entry added to project log'
