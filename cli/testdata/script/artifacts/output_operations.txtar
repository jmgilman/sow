# SKIP: Test uses removed 'sow project new' command
# TODO: Update test to use new interactive wizard or SDK directly
# Related PR: #83 - Wizard Foundation and State Machine

skip 'Test requires update for wizard interface - sow project new command removed'

# Test: Output Operations
# Coverage: add, set, remove, list for phase outputs

exec git init
exec git config user.email 'test@example.com'
exec git config user.name 'Test User'
exec sh -c 'echo ".sow/worktrees/" > .gitignore'
exec git add .gitignore
exec git commit -m 'Initial commit'
exec git checkout -b feat/test
exec sow init
exec git add .sow
exec git commit -m 'Initialize sow'

env SOW_SKIP_UNCOMMITTED_CHECK=1

exec sow project new --branch feat/test --no-launch test-outputs

# Change into worktree
cd .sow/worktrees/feat/test

# Create test file
exec mkdir -p .sow/project/context
exec sh -c 'echo "Task list" > .sow/project/context/task_list.md'

# Test: Add output artifact
exec sow output add --type task_list --path context/task_list.md --phase implementation
exec cat .sow/project/state.yaml
stdout 'type: task_list'
stdout 'path: context/task_list.md'
stdout 'approved: false'

# Test: List outputs (shows index and details)
exec sow output list --phase implementation
stdout '\[0\]'
stdout 'Type: task_list'
stdout 'Path: context/task_list.md'
stdout 'Approved: false'

# Test: Set approved field using index
exec sow output set --index 0 approved true --phase implementation
exec cat .sow/project/state.yaml
stdout 'approved: true'

# Test: Set metadata field using field path
exec sow output set --index 0 metadata.format markdown --phase implementation
exec cat .sow/project/state.yaml
stdout 'format: markdown'

# Test: List shows updated values
exec sow output list --phase implementation
stdout 'Approved: true'
stdout 'format: markdown'

# Test: Add second output
exec sh -c 'echo "Design doc" > .sow/project/context/design.md'
exec sow output add --type task_list --path context/design.md --phase implementation
exec sow output list --phase implementation
stdout '\[0\]'
stdout '\[1\]'
stdout 'task_list.md'
stdout 'design.md'

# Test: Remove output by index (remove first one)
exec sow output remove --index 0 --phase implementation
exec sow output list --phase implementation
stdout '\[0\]'
! stdout '\[1\]'
stdout 'design.md'
! stdout 'tasks.md'
