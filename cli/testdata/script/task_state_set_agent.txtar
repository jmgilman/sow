# Test task state set-agent command
# Should change the assigned agent

exec git init
exec git config user.email 'test@example.com'
exec git config user.name 'Test User'
exec git commit --allow-empty -m 'Initial commit'
exec git checkout -b feat/test-feature
exec sow init
exec sow project init my-feature --description 'Add new feature'

# Add a task with default agent (implementer)
exec sow task add 'Add authentication' --description 'Implement JWT auth'
stderr '✓ Created task 010'

# Verify initial agent is implementer
exec cat .sow/project/phases/implementation/tasks/010/state.yaml
stdout 'assigned_agent: implementer'

# Change to reviewer
exec sow task state set-agent reviewer 010
stderr '✓ Updated assigned agent: implementer → reviewer'

# Verify agent was changed
exec cat .sow/project/phases/implementation/tasks/010/state.yaml
stdout 'assigned_agent: reviewer'

# Change to architect
exec sow task state set-agent architect 010
stderr '✓ Updated assigned agent: reviewer → architect'

# Verify agent was changed again
exec cat .sow/project/phases/implementation/tasks/010/state.yaml
stdout 'assigned_agent: architect'

# Test with non-existent task
! exec sow task state set-agent implementer 099
stderr 'not found'

# Verify state validates
exec sow validate
stderr '✓ All validations passed'
